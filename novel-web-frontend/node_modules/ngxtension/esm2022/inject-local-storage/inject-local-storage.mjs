import { DestroyRef, InjectionToken, effect, inject, signal, } from '@angular/core';
import { assertInjector } from 'ngxtension/assert-injector';
export const NGXTENSION_LOCAL_STORAGE = new InjectionToken('NGXTENSION_LOCAL_STORAGE', {
    providedIn: 'root',
    factory: () => localStorage, // this would be the default
});
export function provideLocalStorageImpl(impl) {
    return {
        provide: NGXTENSION_LOCAL_STORAGE,
        useValue: impl,
    };
}
function isLocalStorageWithDefaultValue(options) {
    return 'defaultValue' in options;
}
function isFunction(value) {
    return typeof value === 'function';
}
function goodTry(tryFn) {
    try {
        return tryFn();
    }
    catch {
        return undefined;
    }
}
function parseJSON(value) {
    return value === 'undefined' ? undefined : JSON.parse(value);
}
export const injectLocalStorage = (key, options = {}) => {
    if (isLocalStorageWithDefaultValue(options)) {
        const defaultValue = isFunction(options.defaultValue)
            ? options.defaultValue()
            : options.defaultValue;
        return internalInjectLocalStorage(key, options, defaultValue);
    }
    return internalInjectLocalStorage(key, options, undefined);
};
const internalInjectLocalStorage = (key, options, defaultValue) => {
    const stringify = isFunction(options.stringify)
        ? options.stringify
        : JSON.stringify;
    const parse = isFunction(options.parse) ? options.parse : parseJSON;
    const storageSync = options.storageSync ?? true;
    return assertInjector(injectLocalStorage, options.injector, () => {
        const localStorage = inject(NGXTENSION_LOCAL_STORAGE);
        const destroyRef = inject(DestroyRef);
        const initialStoredValue = goodTry(() => localStorage.getItem(key));
        const initialValue = initialStoredValue
            ? goodTry(() => parse(initialStoredValue)) ?? defaultValue
            : defaultValue;
        const internalSignal = signal(initialValue);
        effect(() => {
            const value = internalSignal();
            if (value === undefined) {
                goodTry(() => localStorage.removeItem(key));
            }
            else {
                goodTry(() => localStorage.setItem(key, stringify(value)));
            }
        });
        if (storageSync) {
            const onStorage = (event) => {
                if (event.storageArea === localStorage && event.key === key) {
                    const newValue = event.newValue !== null
                        ? parse(event.newValue)
                        : defaultValue;
                    internalSignal.set(newValue);
                }
            };
            window.addEventListener('storage', onStorage);
            destroyRef.onDestroy(() => {
                window.removeEventListener('storage', onStorage);
            });
        }
        return internalSignal;
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5qZWN0LWxvY2FsLXN0b3JhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWJzL25neHRlbnNpb24vaW5qZWN0LWxvY2FsLXN0b3JhZ2Uvc3JjL2luamVjdC1sb2NhbC1zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTixVQUFVLEVBQ1YsY0FBYyxFQUNkLE1BQU0sRUFDTixNQUFNLEVBQ04sTUFBTSxHQUdOLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUU1RCxNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLGNBQWMsQ0FDekQsMEJBQTBCLEVBQzFCO0lBQ0MsVUFBVSxFQUFFLE1BQU07SUFDbEIsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksRUFBRSw0QkFBNEI7Q0FDekQsQ0FDRCxDQUFDO0FBRUYsTUFBTSxVQUFVLHVCQUF1QixDQUFDLElBQW9DO0lBQzNFLE9BQU87UUFDTixPQUFPLEVBQUUsd0JBQXdCO1FBQ2pDLFFBQVEsRUFBRSxJQUFJO0tBQ2QsQ0FBQztBQUNILENBQUM7QUEyQ0QsU0FBUyw4QkFBOEIsQ0FDdEMsT0FBK0I7SUFFL0IsT0FBTyxjQUFjLElBQUksT0FBTyxDQUFDO0FBQ2xDLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxLQUFjO0lBQ2pDLE9BQU8sT0FBTyxLQUFLLEtBQUssVUFBVSxDQUFDO0FBQ3BDLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBSSxLQUFjO0lBQ2pDLElBQUksQ0FBQztRQUNKLE9BQU8sS0FBSyxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUFDLE1BQU0sQ0FBQztRQUNSLE9BQU8sU0FBUyxDQUFDO0lBQ2xCLENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUMsS0FBYTtJQUMvQixPQUFPLEtBQUssS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLFNB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Q0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzlCLENBQUM7WUFDRixDQUFDLENBQUM7WUFFRixNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQzlDLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUN6QixNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ2xELENBQUMsQ0FBQyxDQUFDO1FBQ0osQ0FBQztRQUVELE9BQU8sY0FBYyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0RGVzdHJveVJlZixcblx0SW5qZWN0aW9uVG9rZW4sXG5cdGVmZmVjdCxcblx0aW5qZWN0LFxuXHRzaWduYWwsXG5cdHR5cGUgSW5qZWN0b3IsXG5cdHR5cGUgV3JpdGFibGVTaWduYWwsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgYXNzZXJ0SW5qZWN0b3IgfSBmcm9tICduZ3h0ZW5zaW9uL2Fzc2VydC1pbmplY3Rvcic7XG5cbmV4cG9ydCBjb25zdCBOR1hURU5TSU9OX0xPQ0FMX1NUT1JBR0UgPSBuZXcgSW5qZWN0aW9uVG9rZW4oXG5cdCdOR1hURU5TSU9OX0xPQ0FMX1NUT1JBR0UnLFxuXHR7XG5cdFx0cHJvdmlkZWRJbjogJ3Jvb3QnLFxuXHRcdGZhY3Rvcnk6ICgpID0+IGxvY2FsU3RvcmFnZSwgLy8gdGhpcyB3b3VsZCBiZSB0aGUgZGVmYXVsdFxuXHR9LFxuKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVMb2NhbFN0b3JhZ2VJbXBsKGltcGw6IHR5cGVvZiBnbG9iYWxUaGlzLmxvY2FsU3RvcmFnZSkge1xuXHRyZXR1cm4ge1xuXHRcdHByb3ZpZGU6IE5HWFRFTlNJT05fTE9DQUxfU1RPUkFHRSxcblx0XHR1c2VWYWx1ZTogaW1wbCxcblx0fTtcbn1cblxuLyoqXG4gKiBPcHRpb25zIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIHRoZSBsb2NhbCBzdG9yYWdlIHNpZ25hbC5cbiAqL1xuZXhwb3J0IHR5cGUgTG9jYWxTdG9yYWdlT3B0aW9uc05vRGVmYXVsdCA9IHtcblx0LyoqXG5cdCAqXG5cdCAqIERldGVybWluZXMgaWYgbG9jYWwgc3RvcmFnZSBzeW5jcyB3aXRoIHRoZSBzaWduYWwuXG5cdCAqIFdoZW4gdHJ1ZSwgdXBkYXRlcyBpbiBvbmUgdGFiIHJlZmxlY3QgaW4gb3RoZXJzLCBpZGVhbCBmb3Igc2hhcmVkLXN0YXRlIGFwcHMuXG5cdCAqIERlZmF1bHRzIHRvIHRydWUuXG5cdCAqL1xuXHRzdG9yYWdlU3luYz86IGJvb2xlYW47XG5cdC8qKlxuXHQgKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBKU09OLnN0cmluZ2lmeSBmdW5jdGlvbiBmb3IgY3VzdG9tIHNlcmlhbGl6YXRpb24uXG5cdCAqIEBwYXJhbSB2YWx1ZVxuXHQgKi9cblx0c3RyaW5naWZ5PzogKHZhbHVlOiB1bmtub3duKSA9PiBzdHJpbmc7XG5cdC8qKlxuXHQgKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBKU09OLnBhcnNlIGZ1bmN0aW9uIGZvciBjdXN0b20gZGVzZXJpYWxpemF0aW9uLlxuXHQgKiBAcGFyYW0gdmFsdWVcblx0ICovXG5cdHBhcnNlPzogKHZhbHVlOiBzdHJpbmcpID0+IHVua25vd247XG5cblx0LyoqXG5cdCAqIEluamVjdG9yIGZvciB0aGUgSW5qZWN0aW9uIENvbnRleHRcblx0ICovXG5cdGluamVjdG9yPzogSW5qZWN0b3I7XG59O1xuXG5leHBvcnQgdHlwZSBMb2NhbFN0b3JhZ2VPcHRpb25zV2l0aERlZmF1bHRWYWx1ZTxUPiA9XG5cdExvY2FsU3RvcmFnZU9wdGlvbnNOb0RlZmF1bHQgJiB7XG5cdFx0LyoqXG5cdFx0ICogRGVmYXVsdCB2YWx1ZSBmb3IgdGhlIHNpZ25hbC5cblx0XHQgKiBDYW4gYmUgYSB2YWx1ZSBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgdmFsdWUuXG5cdFx0ICovXG5cdFx0ZGVmYXVsdFZhbHVlOiBUIHwgKCgpID0+IFQpO1xuXHR9O1xuXG5leHBvcnQgdHlwZSBMb2NhbFN0b3JhZ2VPcHRpb25zPFQ+ID1cblx0fCBMb2NhbFN0b3JhZ2VPcHRpb25zTm9EZWZhdWx0XG5cdHwgTG9jYWxTdG9yYWdlT3B0aW9uc1dpdGhEZWZhdWx0VmFsdWU8VD47XG5cbmZ1bmN0aW9uIGlzTG9jYWxTdG9yYWdlV2l0aERlZmF1bHRWYWx1ZTxUPihcblx0b3B0aW9uczogTG9jYWxTdG9yYWdlT3B0aW9uczxUPixcbik6IG9wdGlvbnMgaXMgTG9jYWxTdG9yYWdlT3B0aW9uc1dpdGhEZWZhdWx0VmFsdWU8VD4ge1xuXHRyZXR1cm4gJ2RlZmF1bHRWYWx1ZScgaW4gb3B0aW9ucztcbn1cblxuZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzICguLi5hcmdzOiB1bmtub3duW10pID0+IHVua25vd24ge1xuXHRyZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nO1xufVxuXG5mdW5jdGlvbiBnb29kVHJ5PFQ+KHRyeUZuOiAoKSA9PiBUKTogVCB8IHVuZGVmaW5lZCB7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRyeUZuKCk7XG5cdH0gY2F0Y2gge1xuXHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdH1cbn1cblxuZnVuY3Rpb24gcGFyc2VKU09OKHZhbHVlOiBzdHJpbmcpOiB1bmtub3duIHtcblx0cmV0dXJuIHZhbHVlID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEpTT04ucGFyc2UodmFsdWUpO1xufVxuXG5leHBvcnQgY29uc3QgaW5qZWN0TG9jYWxTdG9yYWdlOiB7XG5cdDxUPihcblx0XHRrZXk6IHN0cmluZyxcblx0XHRvcHRpb25zOiBMb2NhbFN0b3JhZ2VPcHRpb25zV2l0aERlZmF1bHRWYWx1ZTxUPixcblx0KTogV3JpdGFibGVTaWduYWw8VD47XG5cdDxUPihcblx0XHRrZXk6IHN0cmluZyxcblx0XHRvcHRpb25zPzogTG9jYWxTdG9yYWdlT3B0aW9uc05vRGVmYXVsdCxcblx0KTogV3JpdGFibGVTaWduYWw8VCB8IHVuZGVmaW5lZD47XG59ID0gPFQ+KFxuXHRrZXk6IHN0cmluZyxcblx0b3B0aW9uczogTG9jYWxTdG9yYWdlT3B0aW9uczxUPiA9IHt9LFxuKTogV3JpdGFibGVTaWduYWw8VCB8IHVuZGVmaW5lZD4gPT4ge1xuXHRpZiAoaXNMb2NhbFN0b3JhZ2VXaXRoRGVmYXVsdFZhbHVlKG9wdGlvbnMpKSB7XG5cdFx0Y29uc3QgZGVmYXVsdFZhbHVlID0gaXNGdW5jdGlvbihvcHRpb25zLmRlZmF1bHRWYWx1ZSlcblx0XHRcdD8gb3B0aW9ucy5kZWZhdWx0VmFsdWUoKVxuXHRcdFx0OiBvcHRpb25zLmRlZmF1bHRWYWx1ZTtcblxuXHRcdHJldHVybiBpbnRlcm5hbEluamVjdExvY2FsU3RvcmFnZTxUPihrZXksIG9wdGlvbnMsIGRlZmF1bHRWYWx1ZSk7XG5cdH1cblx0cmV0dXJuIGludGVybmFsSW5qZWN0TG9jYWxTdG9yYWdlPFQgfCB1bmRlZmluZWQ+KGtleSwgb3B0aW9ucywgdW5kZWZpbmVkKTtcbn07XG5cbmNvbnN0IGludGVybmFsSW5qZWN0TG9jYWxTdG9yYWdlID0gPFI+KFxuXHRrZXk6IHN0cmluZyxcblx0b3B0aW9uczogTG9jYWxTdG9yYWdlT3B0aW9uczxSPixcblx0ZGVmYXVsdFZhbHVlOiBSLFxuKTogV3JpdGFibGVTaWduYWw8Uj4gPT4ge1xuXHRjb25zdCBzdHJpbmdpZnkgPSBpc0Z1bmN0aW9uKG9wdGlvbnMuc3RyaW5naWZ5KVxuXHRcdD8gb3B0aW9ucy5zdHJpbmdpZnlcblx0XHQ6IEpTT04uc3RyaW5naWZ5O1xuXHRjb25zdCBwYXJzZSA9IGlzRnVuY3Rpb24ob3B0aW9ucy5wYXJzZSkgPyBvcHRpb25zLnBhcnNlIDogcGFyc2VKU09OO1xuXHRjb25zdCBzdG9yYWdlU3luYyA9IG9wdGlvbnMuc3RvcmFnZVN5bmMgPz8gdHJ1ZTtcblx0cmV0dXJuIGFzc2VydEluamVjdG9yKGluamVjdExvY2FsU3RvcmFnZSwgb3B0aW9ucy5pbmplY3RvciwgKCkgPT4ge1xuXHRcdGNvbnN0IGxvY2FsU3RvcmFnZSA9IGluamVjdChOR1hURU5TSU9OX0xPQ0FMX1NUT1JBR0UpO1xuXHRcdGNvbnN0IGRlc3Ryb3lSZWYgPSBpbmplY3QoRGVzdHJveVJlZik7XG5cblx0XHRjb25zdCBpbml0aWFsU3RvcmVkVmFsdWUgPSBnb29kVHJ5KCgpID0+IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpO1xuXHRcdGNvbnN0IGluaXRpYWxWYWx1ZSA9IGluaXRpYWxTdG9yZWRWYWx1ZVxuXHRcdFx0PyBnb29kVHJ5KCgpID0+IHBhcnNlKGluaXRpYWxTdG9yZWRWYWx1ZSkgYXMgUikgPz8gZGVmYXVsdFZhbHVlXG5cdFx0XHQ6IGRlZmF1bHRWYWx1ZTtcblx0XHRjb25zdCBpbnRlcm5hbFNpZ25hbCA9IHNpZ25hbChpbml0aWFsVmFsdWUpO1xuXG5cdFx0ZWZmZWN0KCgpID0+IHtcblx0XHRcdGNvbnN0IHZhbHVlID0gaW50ZXJuYWxTaWduYWwoKTtcblx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGdvb2RUcnkoKCkgPT4gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRnb29kVHJ5KCgpID0+IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgc3RyaW5naWZ5KHZhbHVlKSkpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKHN0b3JhZ2VTeW5jKSB7XG5cdFx0XHRjb25zdCBvblN0b3JhZ2UgPSAoZXZlbnQ6IFN0b3JhZ2VFdmVudCkgPT4ge1xuXHRcdFx0XHRpZiAoZXZlbnQuc3RvcmFnZUFyZWEgPT09IGxvY2FsU3RvcmFnZSAmJiBldmVudC5rZXkgPT09IGtleSkge1xuXHRcdFx0XHRcdGNvbnN0IG5ld1ZhbHVlID1cblx0XHRcdFx0XHRcdGV2ZW50Lm5ld1ZhbHVlICE9PSBudWxsXG5cdFx0XHRcdFx0XHRcdD8gKHBhcnNlKGV2ZW50Lm5ld1ZhbHVlKSBhcyBSKVxuXHRcdFx0XHRcdFx0XHQ6IGRlZmF1bHRWYWx1ZTtcblx0XHRcdFx0XHRpbnRlcm5hbFNpZ25hbC5zZXQobmV3VmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc3RvcmFnZScsIG9uU3RvcmFnZSk7XG5cdFx0XHRkZXN0cm95UmVmLm9uRGVzdHJveSgoKSA9PiB7XG5cdFx0XHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgb25TdG9yYWdlKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBpbnRlcm5hbFNpZ25hbDtcblx0fSk7XG59O1xuIl19